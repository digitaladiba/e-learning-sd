<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>LMS Sekolah Digital SD</title>
  
  <!-- 1. LIBRARY & FONT (Wajib Online) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Font Fredoka (Bulat & Lucu untuk SD) -->
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600&display=swap" rel="stylesheet">
  
  <style>
    /* 2. STYLE KHUSUS */
    body { 
      font-family: 'Fredoka', sans-serif; 
      background-color: #f0f9ff; /* Biru langit muda */
      -webkit-tap-highlight-color: transparent; 
    }
    
    /* Sembunyikan Scrollbar tapi tetap bisa scroll */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Efek Kartu Timbul (3D Flat) */
    .card-sd {
      background: white; 
      border-radius: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      border-bottom: 4px solid #e2e8f0; /* Efek tebal bawah */
      transition: transform 0.1s;
    }
    .card-sd:active { 
      transform: scale(0.98); 
      border-bottom: 2px solid #e2e8f0; 
    }

    /* Tombol Utama */
    .btn-primary {
      background: linear-gradient(to bottom right, #3b82f6, #2563eb);
      color: white; border-radius: 16px;
      border-bottom: 4px solid #1e40af;
      transition: all 0.2s;
    }
    .btn-primary:active { transform: translateY(2px); border-bottom: 0px; }

    /* Animasi Masuk */
    .fade-in { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="h-screen flex flex-col text-slate-700 overflow-hidden select-none">

  <!-- 3. LOADER (Layar Tunggu) -->
  <div id="loader" class="fixed inset-0 z-50 bg-white flex flex-col items-center justify-center hidden">
    <div class="animate-bounce mb-4 text-5xl">ðŸš€</div>
    <p class="font-bold text-blue-500 animate-pulse text-lg">Siap Meluncur...</p>
  </div>

  <!-- 4. HALAMAN LOGIN -->
  <div id="pageLogin" class="fixed inset-0 z-40 bg-blue-50 flex flex-col items-center justify-center p-6 fade-in">
    <div class="bg-white p-8 rounded-[35px] w-full max-w-sm shadow-xl text-center border-b-8 border-blue-100">
      <!-- Ikon Login -->
      <div class="w-24 h-24 bg-yellow-300 rounded-full mx-auto -mt-16 mb-6 flex items-center justify-center shadow-lg border-4 border-white animate-bounce">
        <i class="fas fa-graduation-cap text-4xl text-blue-600"></i>
      </div>
      
      <h1 class="text-3xl font-bold text-slate-800 mb-1">Sekolah Digital</h1>
      <p class="text-slate-400 text-sm mb-8 font-medium">Belajar jadi seru & mudah!</p>

      <div class="text-left space-y-4">
        <div>
          <label class="block text-xs font-bold text-slate-400 uppercase ml-2 mb-1">Email Sekolah</label>
          <div class="relative">
            <i class="fas fa-envelope absolute left-4 top-4 text-slate-300"></i>
            <input type="email" id="emailInput" 
              class="w-full bg-slate-50 border-2 border-slate-200 rounded-2xl py-3 pl-10 pr-4 focus:outline-none focus:border-blue-400 font-bold text-slate-700 transition" 
              placeholder="siswa1@sekolah.id">
          </div>
        </div>
        
        <button onclick="doLogin()" class="w-full btn-primary py-4 font-bold text-lg flex justify-center items-center gap-2 shadow-lg shadow-blue-200">
          MASUK KELAS <i class="fas fa-arrow-right"></i>
        </button>
        
        <p id="loginError" class="text-red-500 text-center text-sm font-bold h-5 mt-2"></p>
      </div>
    </div>
    <p class="mt-8 text-xs font-bold text-blue-300 uppercase tracking-widest">Versi Pelajar SD 1.0</p>
  </div>

  <!-- 5. HALAMAN UTAMA (Aplikasi) -->
  <div id="pageApp" class="hidden flex flex-col h-full bg-slate-50 relative max-w-md mx-auto w-full shadow-2xl border-x border-slate-100">
    
    <!-- HEADER ATAS -->
    <header class="bg-white px-6 pt-10 pb-4 rounded-b-[30px] shadow-sm z-10 flex justify-between items-center sticky top-0">
      <div>
        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">SELAMAT PAGI,</p>
        <div class="flex items-center gap-2">
            <h2 id="uName" class="text-xl font-bold text-blue-600 truncate max-w-[180px]">Nama Siswa</h2>
            <i class="fas fa-check-circle text-blue-400 text-xs"></i>
        </div>
        <span id="uClass" class="bg-yellow-100 text-yellow-700 text-[10px] font-bold px-3 py-1 rounded-full border border-yellow-200 mt-1 inline-block">KELAS -</span>
      </div>
      <!-- Tombol Logout -->
      <button onclick="doLogout()" class="w-12 h-12 bg-red-50 rounded-2xl flex items-center justify-center text-red-400 border border-red-100 hover:bg-red-100 transition active:scale-90">
        <i class="fas fa-power-off text-lg"></i>
      </button>
    </header>

    <!-- AREA KONTEN (Bisa di-scroll) -->
    <main class="flex-1 overflow-y-auto p-5 space-y-6 pb-28 no-scrollbar scroll-smooth">
      
      <!-- TAB 1: HOME -->
      <div id="viewHome" class="space-y-5 fade-in">
        
        <!-- Banner Sekolah -->
        <div class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-3xl p-6 text-white shadow-xl shadow-blue-200 relative overflow-hidden group">
          <div class="relative z-10">
            <h3 id="schoolName" class="font-bold text-xl mb-1">Nama Sekolah</h3>
            <p id="schoolAddr" class="text-xs text-blue-100 opacity-90 max-w-[80%] mb-4 leading-relaxed">Alamat Sekolah...</p>
            <div class="inline-flex items-center gap-2 bg-white/20 backdrop-blur-md px-4 py-1.5 rounded-full text-xs font-bold border border-white/20">
              <i class="fas fa-calendar-alt text-yellow-300"></i> TA: <span id="schoolYear">-</span>
            </div>
          </div>
          <!-- Hiasan Background -->
          <i class="fas fa-school absolute -right-6 -bottom-6 text-9xl text-white/10 rotate-12 group-hover:rotate-0 transition duration-500"></i>
          <div class="absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-2xl"></div>
        </div>

        <!-- Statistik -->
        <div class="grid grid-cols-2 gap-4">
          <div class="card-sd p-4 flex flex-col items-center justify-center gap-2">
            <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center text-orange-500 text-xl">
                <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <span id="statGuru" class="text-3xl font-bold text-slate-700">0</span>
            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Guru Kami</span>
          </div>
          <div class="card-sd p-4 flex flex-col items-center justify-center gap-2">
            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-500 text-xl">
                <i class="fas fa-user-friends"></i>
            </div>
            <span id="statSiswa" class="text-3xl font-bold text-slate-700">0</span>
            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Teman Sekolah</span>
          </div>
        </div>

        <!-- Pengumuman -->
        <div>
          <h3 class="font-bold text-slate-700 mb-3 flex items-center gap-2 text-sm uppercase tracking-wider ml-1">
            <i class="fas fa-bullhorn text-yellow-500 animate-pulse"></i> Info Sekolah
          </h3>
          <div id="announcementList" class="space-y-3">
            <!-- Diisi Javascript -->
          </div>
        </div>
      </div>

      <!-- TAB 2: RUANG KELAS -->
      <div id="viewKelas" class="hidden space-y-5 fade-in">
        <div class="text-center mb-6">
          <h2 class="text-2xl font-bold text-slate-800">Ruang Kelas <span id="kelasTitle" class="text-blue-600"></span></h2>
          <p class="text-xs text-slate-400 font-bold">Ayo cek tugas & materi hari ini!</p>
        </div>

        <!-- Filter Menu -->
        <div class="flex p-1.5 bg-white rounded-2xl border border-slate-100 shadow-sm sticky top-0 z-20">
          <button onclick="filterKelas('all')" id="tabAll" class="flex-1 py-2.5 rounded-xl text-xs font-bold transition bg-blue-100 text-blue-600 shadow-sm">Semua</button>
          <button onclick="filterKelas('tugas')" id="tabTugas" class="flex-1 py-2.5 rounded-xl text-xs font-bold transition text-slate-400 hover:text-purple-500">PR/Tugas</button>
          <button onclick="filterKelas('jadwal')" id="tabJadwal" class="flex-1 py-2.5 rounded-xl text-xs font-bold transition text-slate-400 hover:text-green-500">Jadwal</button>
        </div>

        <div id="kelasContent" class="space-y-3 pb-10 min-h-[300px]">
          <!-- Konten Dinamis -->
        </div>
      </div>

    </main>

    <!-- 6. NAVIGASI BAWAH (Menu Utama) -->
    <nav class="absolute bottom-6 left-6 right-6 bg-white h-[70px] rounded-[24px] shadow-[0_8px_30px_rgba(0,0,0,0.12)] flex justify-around items-center px-4 z-30 border border-slate-50">
      
      <!-- Tombol Home -->
      <button onclick="navTo('home')" id="navHome" class="flex flex-col items-center gap-1 text-blue-600 w-16 transition active:scale-90 group">
        <i class="fas fa-home text-2xl group-hover:-translate-y-1 transition"></i>
        <span class="text-[9px] font-bold">Home</span>
      </button>
      
      <!-- Tombol Tengah (Ruang Kelas) -->
      <button onclick="navTo('kelas')" id="navKelas" class="relative -top-8 w-16 h-16 bg-white rounded-full flex items-center justify-center text-blue-600 shadow-xl border-[6px] border-slate-50 transition active:scale-90 group">
        <div class="w-full h-full rounded-full bg-blue-600 flex items-center justify-center text-white group-hover:bg-blue-500 transition">
             <i class="fas fa-book-open text-xl"></i>
        </div>
      </button>

      <!-- Tombol Akun (Dummy) -->
      <button onclick="alert('Halo! Ini profil kamu.')" class="flex flex-col items-center gap-1 text-slate-300 w-16 transition active:scale-90 hover:text-slate-400">
        <i class="fas fa-user-astronaut text-2xl"></i>
        <span class="text-[9px] font-bold">Akun</span>
      </button>
    </nav>

  </div>

<script>
// ==========================================
// KONFIGURASI API (URL ANDA)
// ==========================================
const API_URL = "https://script.google.com/macros/s/AKfycbx9R2KHLhCbyIthh1_j6MoZ_Xxohh99NYfvN4iTMEbaDdp-HG4ZI4zMjmVjdKfFn3aqaA/exec";

// Variabel Global
let USER = null;
let CACHE_KELAS = null;

// Fungsi Singkat
const el = (id) => document.getElementById(id);
const showLoader = () => el('loader').classList.remove('hidden');
const hideLoader = () => el('loader').classList.add('hidden');

// 1. FUNGSI LOGIN
function doLogin(){
  const email = el('emailInput').value.trim();
  if(!email) {
    el('loginError').innerText = "Isi email dulu ya! ðŸ¥º";
    return;
  }
  
  showLoader();
  el('loginError').innerText = "";

  // Panggil API Google Script
  fetch(`${API_URL}?action=login&email=${email}`)
    .then(r => r.json())
    .then(d => {
      hideLoader();
      if(d.status){
        USER = d;
        initApp(); // Masuk ke Aplikasi
      } else {
        el('loginError').innerText = "Email tidak ditemukan / salah âŒ";
      }
    })
    .catch(err => {
      hideLoader();
      alert("Gagal koneksi. Cek internet kamu ya! ðŸ“¶");
    });
}

function doLogout(){
  if(confirm("Yakin mau keluar aplikasi? ðŸ‘‹")){
    location.reload();
  }
}

// 2. INISIALISASI APLIKASI
function initApp(){
  // Animasi Transisi
  el('pageLogin').classList.add('hidden');
  el('pageApp').classList.remove('hidden');
  
  // Isi Data Header
  el('uName').innerText = USER.nama;
  el('uClass').innerText = `KELAS ${USER.kelas}`;
  el('kelasTitle').innerText = USER.kelas;

  // Ambil Data
  loadHomeData();
  loadKelasData();
}

// 3. NAVIGASI TAB
function navTo(page){
  if(page === 'home'){
    el('viewHome').classList.remove('hidden');
    el('viewKelas').classList.add('hidden');
    
    // Warna Ikon
    el('navHome').className = "flex flex-col items-center gap-1 text-blue-600 w-16 transition active:scale-90 group";
    el('navKelas').querySelector('div').className = "w-full h-full rounded-full bg-slate-200 flex items-center justify-center text-slate-500 transition";
    
  } else if (page === 'kelas'){
    el('viewHome').classList.add('hidden');
    el('viewKelas').classList.remove('hidden');
    
    // Warna Ikon
    el('navHome').className = "flex flex-col items-center gap-1 text-slate-300 w-16 transition active:scale-90 group";
    el('navKelas').querySelector('div').className = "w-full h-full rounded-full bg-blue-600 flex items-center justify-center text-white shadow-lg transition";
  }
}

// 4. LOAD DATA HOME
function loadHomeData(){
  fetch(`${API_URL}?action=home`)
    .then(r => r.json())
    .then(d => {
      // Isi Info Sekolah
      el('schoolName').innerText = d.info.nama;
      el('schoolAddr').innerText = d.info.alamat;
      el('schoolYear').innerText = d.info.tahun;
      el('statGuru').innerText = d.statistik.guru;
      el('statSiswa').innerText = d.statistik.siswa;

      // Isi Pengumuman
      const html = d.pengumuman.map(p => `
        <div class="card-sd p-4 flex gap-3 items-start border-l-4 border-l-yellow-400">
          <div class="bg-yellow-100 text-yellow-600 w-10 h-10 rounded-full flex items-center justify-center shrink-0">
            <i class="fas fa-bell"></i>
          </div>
          <div>
            <h4 class="font-bold text-slate-700 text-sm leading-tight">${p.judul}</h4>
            <p class="text-xs text-slate-500 mt-1 line-clamp-2">${p.isi}</p>
            <span class="text-[10px] text-blue-400 font-bold mt-2 block bg-blue-50 w-fit px-2 py-0.5 rounded">${p.tanggal}</span>
          </div>
        </div>
      `).join('');
      el('announcementList').innerHTML = html || '<div class="text-center text-xs text-slate-400 py-4 border-2 border-dashed rounded-xl">Belum ada info baru ðŸ“­</div>';
    });
}

// 5. LOAD DATA KELAS
function loadKelasData(){
  fetch(`${API_URL}?action=ruangkelas&kelas=${USER.kelas}`)
    .then(r => r.json())
    .then(d => {
      CACHE_KELAS = d;
      renderKelas('all'); // Tampilkan semua di awal
    });
}

// 6. RENDER KELAS (FILTER)
function filterKelas(mode){
  // Reset Warna Tombol Filter
  const baseClass = "flex-1 py-2.5 rounded-xl text-xs font-bold transition";
  el('tabAll').className = `${baseClass} text-slate-400 hover:bg-slate-50`;
  el('tabTugas').className = `${baseClass} text-slate-400 hover:bg-slate-50`;
  el('tabJadwal').className = `${baseClass} text-slate-400 hover:bg-slate-50`;

  // Set Warna Aktif
  if(mode === 'all') el('tabAll').className = `${baseClass} bg-blue-100 text-blue-600 shadow-sm`;
  if(mode === 'tugas') el('tabTugas').className = `${baseClass} bg-purple-100 text-purple-600 shadow-sm`;
  if(mode === 'jadwal') el('tabJadwal').className = `${baseClass} bg-green-100 text-green-600 shadow-sm`;

  renderKelas(mode);
}

function renderKelas(mode){
  if(!CACHE_KELAS) return;
  let html = '';

  // === A. JADWAL (Hijau) ===
  if(mode === 'all' || mode === 'jadwal'){
    if(CACHE_KELAS.jadwal.length > 0){
      html += `<div class="mb-2 mt-2 px-1"><span class="text-xs font-extrabold text-green-600 uppercase tracking-wider"><i class="fas fa-calendar-alt mr-1"></i> Jadwal Pelajaran</span></div>`;
      CACHE_KELAS.jadwal.forEach(j => {
        html += `
        <div class="card-sd p-3 flex items-center gap-3 mb-3 border-l-4 border-l-green-400">
           <div class="w-12 h-12 bg-green-50 rounded-xl flex flex-col items-center justify-center text-green-600">
             <span class="text-[9px] font-black uppercase tracking-tighter">${j.hari.substring(0,3)}</span>
             <i class="fas fa-clock text-xs mt-0.5"></i>
           </div>
           <div>
             <h4 class="font-bold text-slate-700 text-sm">${j.mapel}</h4>
             <p class="text-xs text-slate-500 font-medium">${j.jam} â€¢ ${j.guru}</p>
           </div>
        </div>`;
      });
    } else if(mode === 'jadwal') {
       html += emptyState("Tidak ada jadwal hari ini");
    }
  }

  // === B. TUGAS (Ungu) ===
  if(mode === 'all' || mode === 'tugas'){
    if(CACHE_KELAS.tugas.length > 0){
      html += `<div class="mb-2 mt-4 px-1"><span class="text-xs font-extrabold text-purple-600 uppercase tracking-wider"><i class="fas fa-tasks mr-1"></i> PR & Tugas</span></div>`;
      CACHE_KELAS.tugas.forEach(t => {
        html += `
        <div class="bg-white rounded-[20px] p-4 mb-3 shadow-sm border border-slate-100 relative overflow-hidden group">
           <div class="absolute left-0 top-0 bottom-0 w-2 bg-purple-500"></div>
           <div class="flex justify-between items-start pl-3">
              <div>
                <span class="bg-purple-100 text-purple-700 text-[9px] font-bold px-2 py-0.5 rounded border border-purple-200">${t.mapel}</span>
                <h4 class="font-bold text-slate-700 mt-2 text-sm leading-tight">${t.judul}</h4>
                <p class="text-[10px] text-slate-400 mt-1 font-bold"><i class="fas fa-stopwatch text-red-400"></i> Deadline: ${t.deadline}</p>
              </div>
              <button class="w-8 h-8 rounded-full bg-purple-50 text-purple-500 flex items-center justify-center hover:bg-purple-500 hover:text-white transition">
                <i class="fas fa-pencil-alt text-xs"></i>
              </button>
           </div>
        </div>`;
      });
    } else if (mode === 'tugas') {
      html += emptyState("Hore! Tidak ada PR ðŸŽ‰");
    }
  }

  // === C. MATERI (Biru - Hanya muncul di All) ===
  if(mode === 'all'){
    if(CACHE_KELAS.materi.length > 0){
      html += `<div class="mb-2 mt-4 px-1"><span class="text-xs font-extrabold text-blue-600 uppercase tracking-wider"><i class="fas fa-book mr-1"></i> Materi Belajar</span></div>`;
      CACHE_KELAS.materi.forEach(m => {
        html += `
        <a href="${m.link}" target="_blank" class="card-sd p-3 flex items-center gap-3 mb-3 border-l-4 border-l-blue-400 active:bg-blue-50 group">
           <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center text-blue-500 group-hover:scale-110 transition">
             <i class="fas fa-file-alt"></i>
           </div>
           <div class="flex-1">
             <h4 class="font-bold text-slate-700 text-sm group-hover:text-blue-600 transition">${m.mapel}</h4>
             <p class="text-xs text-slate-500 truncate">${m.judul}</p>
           </div>
           <i class="fas fa-chevron-right text-slate-300 text-xs"></i>
        </a>`;
      });
    }
  }

  el('kelasContent').innerHTML = html;
}

function emptyState(msg){
    return `<div class="flex flex-col items-center justify-center py-10 opacity-60">
        <i class="fas fa-cookie-bite text-4xl text-slate-300 mb-2"></i>
        <p class="text-xs font-bold text-slate-400">${msg}</p>
    </div>`;
}
</script>
</body>
</html>