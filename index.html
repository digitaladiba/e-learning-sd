<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>LMS SDN 04 Taman</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600&display=swap" rel="stylesheet">
  
  <style>
    body { font-family: 'Fredoka', sans-serif; background-color: #fdf4ff; -webkit-tap-highlight-color: transparent; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    
    /* Animasi Sidebar */
    #sidebar { transition: transform 0.3s ease-in-out; transform: translateX(-100%); }
    #sidebar.open { transform: translateX(0); }
    
    /* Tombol Toggle */
    .btn-toggle {
        position: fixed; top: 50%; left: 0; transform: translateY(-50%);
        background: #c026d3; color: white;
        padding: 12px 8px 12px 4px;
        border-radius: 0 12px 12px 0;
        box-shadow: 2px 0 10px rgba(192, 38, 211, 0.3);
        z-index: 50; cursor: pointer;
    }

    .card-sd { background: white; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid #fae8ff; }
    .hero-gradient { background: linear-gradient(135deg, #d946ef 0%, #4f46e5 100%); }
    
    .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* Warna Medali */
    .medal-1 { color: #fbbf24; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .medal-2 { color: #94a3b8; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .medal-3 { color: #d97706; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  </style>
</head>
<body class="text-slate-800 h-screen overflow-hidden flex flex-col">

  <!-- 1. TOMBOL TOGGLE SIDEBAR -->
  <div id="sidebarToggle" class="hidden btn-toggle" onclick="toggleSidebar()">
    <i class="fas fa-chevron-right"></i>
  </div>

  <!-- 2. SIDEBAR MENU KIRI -->
  <aside id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-white shadow-2xl z-50 flex flex-col border-r border-fuchsia-100">
    <div class="p-6 bg-fuchsia-600 text-white flex justify-between items-center shadow-md">
        <div>
            <h2 class="font-bold text-lg">Menu Utama</h2>
            <p class="text-xs text-fuchsia-100">SDN 04 Taman</p>
        </div>
        <button onclick="toggleSidebar()" class="w-8 h-8 flex items-center justify-center bg-fuchsia-700 rounded-full hover:bg-fuchsia-800 transition"><i class="fas fa-times"></i></button>
    </div>
    
    <nav class="flex-1 overflow-y-auto p-4 space-y-1">
        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-2">Umum</p>
        <button onclick="navTo('home')" class="w-full text-left p-3 hover:bg-fuchsia-50 rounded-xl flex gap-3 items-center text-sm font-medium text-slate-600 hover:text-fuchsia-600 transition"><i class="fas fa-home w-6 text-center text-blue-500"></i> Beranda</button>
        <button onclick="navTo('berita')" class="w-full text-left p-3 hover:bg-fuchsia-50 rounded-xl flex gap-3 items-center text-sm font-medium text-slate-600 hover:text-fuchsia-600 transition"><i class="fas fa-newspaper w-6 text-center text-blue-500"></i> Berita & Info</button>
        
        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-4">Pembelajaran</p>
        <button onclick="navTo('akademik')" class="w-full text-left p-3 hover:bg-fuchsia-50 rounded-xl flex gap-3 items-center text-sm font-medium text-slate-600 hover:text-fuchsia-600 transition"><i class="fas fa-graduation-cap w-6 text-center text-fuchsia-500"></i> Akademik</button>
        <button onclick="navTo('perpus')" class="w-full text-left p-3 hover:bg-fuchsia-50 rounded-xl flex gap-3 items-center text-sm font-medium text-slate-600 hover:text-fuchsia-600 transition"><i class="fas fa-book-reader w-6 text-center text-fuchsia-500"></i> Perpus Digital</button>
        
        <!-- MENU KHUSUS GURU -->
        <div id="menuGuruSide" class="hidden">
            <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-4">Menu Guru</p>
            <button onclick="navTo('nilaiGuru')" class="w-full text-left p-3 hover:bg-fuchsia-50 rounded-xl flex gap-3 items-center text-sm font-medium text-slate-600 hover:text-fuchsia-600 transition"><i class="fas fa-star w-6 text-center text-orange-500"></i> Input Nilai</button>
            <button onclick="navTo('mading')" class="w-full text-left p-3 hover:bg-fuchsia-50 rounded-xl flex gap-3 items-center text-sm font-medium text-slate-600 hover:text-fuchsia-600 transition"><i class="fas fa-eye w-6 text-center text-slate-400"></i> Lihat Mading</button>
        </div>

        <!-- MENU KHUSUS SISWA -->
        <div id="menuSiswaSide" class="hidden">
            <p class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-4">Menu Siswa</p>
            <button onclick="navTo('nilaiSiswa')" class="w-full text-left p-3 hover:bg-fuchsia-50 rounded-xl flex gap-3 items-center text-sm font-medium text-slate-600 hover:text-fuchsia-600 transition"><i class="fas fa-trophy w-6 text-center text-yellow-500"></i> Nilai & Ranking</button>
            <button onclick="navTo('mading')" class="w-full text-left p-3 hover:bg-fuchsia-50 rounded-xl flex gap-3 items-center text-sm font-medium text-slate-600 hover:text-fuchsia-600 transition"><i class="fas fa-clipboard-list w-6 text-center text-blue-500"></i> Mading Kelas</button>
        </div>
        
        <div class="mt-4 pt-4 border-t border-fuchsia-100">
            <button onclick="navTo('profil')" class="w-full text-left p-3 hover:bg-fuchsia-50 rounded-xl flex gap-3 items-center text-sm font-medium text-slate-600 hover:text-fuchsia-600 transition"><i class="fas fa-user-circle w-6 text-center text-slate-500"></i> Profil Saya</button>
            <button onclick="doLogout()" class="w-full text-left p-3 mt-1 hover:bg-red-50 rounded-xl flex gap-3 items-center text-sm font-medium text-red-500 transition"><i class="fas fa-sign-out-alt w-6 text-center"></i> Keluar</button>
        </div>
    </nav>
  </aside>
  <!-- Overlay -->
  <div id="sidebarOverlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/20 z-40 hidden backdrop-blur-sm transition-opacity"></div>

  <!-- 3. HEADER -->
  <header class="bg-white h-16 flex items-center justify-between px-6 border-b border-fuchsia-100 shadow-sm sticky top-0 z-20">
    <div class="flex items-center gap-2">
        <div class="w-8 h-8 bg-gradient-to-br from-fuchsia-500 to-purple-600 rounded-lg flex items-center justify-center text-white shadow-md"><i class="fas fa-shapes"></i></div>
        <span class="font-bold text-fuchsia-800 tracking-tight text-lg">SDN 04</span>
    </div>
    <div class="flex items-center gap-2">
        <div class="text-right hidden sm:block">
            <p id="headName" class="text-xs font-bold text-slate-700">User</p>
            <p id="headRole" class="text-[10px] text-fuchsia-500 font-bold uppercase">Role</p>
        </div>
        <div class="w-9 h-9 rounded-full bg-fuchsia-50 overflow-hidden border-2 border-fuchsia-200">
            <img id="headImg" src="https://api.dicebear.com/7.x/avataaars/svg" class="w-full h-full object-cover">
        </div>
    </div>
  </header>

  <!-- 4. KONTEN UTAMA -->
  <main id="mainContainer" class="flex-1 overflow-y-auto p-5 pb-24 space-y-6 scroll-smooth bg-fuchsia-50/30">
    
    <!-- VIEW: BERANDA -->
    <div id="viewHome" class="hidden fade-in space-y-5">
        <div class="hero-gradient rounded-3xl p-6 text-white shadow-lg shadow-fuchsia-200 relative overflow-hidden">
            <div class="relative z-10">
                <h2 class="text-2xl font-bold mb-2">Halo, <span id="welcomeName">Siswa</span>! üëã</h2>
                <p class="text-fuchsia-50 text-sm font-medium">Selamat datang di Portal Digital SDN 04 Taman.</p>
            </div>
            <i class="fas fa-rocket absolute -right-6 -bottom-6 text-9xl text-white/10 rotate-12"></i>
        </div>
        
        <div class="card-sd p-5 space-y-4 bg-white/80 backdrop-blur-sm border-fuchsia-100">
            <div class="flex items-center gap-3 border-b border-fuchsia-50 pb-3">
                <div class="w-10 h-10 bg-fuchsia-100 rounded-full flex items-center justify-center text-fuchsia-600"><i class="fas fa-school"></i></div>
                <div>
                    <h3 class="font-bold text-slate-800" id="infoNama">SDN 04 TAMAN</h3>
                    <p class="text-xs text-slate-500" id="infoAlamat">Jl. Pendidikan...</p>
                </div>
            </div>
            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                <h4 class="font-bold text-blue-700 text-xs uppercase mb-1"><i class="fas fa-lightbulb mr-1"></i> Visi & Misi</h4>
                <p class="text-xs text-slate-700 italic leading-relaxed" id="infoVisi">"..."</p>
            </div>
            <div class="grid grid-cols-2 gap-3 text-xs">
                <div class="bg-white border border-slate-100 p-3 rounded-lg shadow-sm">
                    <p class="font-bold text-slate-400 mb-1">Kontak</p>
                    <p class="font-medium text-slate-700" id="infoKontak">-</p>
                </div>
                <div class="bg-white border border-slate-100 p-3 rounded-lg shadow-sm">
                    <p class="font-bold text-slate-400 mb-1">Website</p>
                    <p class="font-medium text-blue-500 truncate" id="infoWeb">-</p>
                </div>
            </div>
        </div>
        <div id="listPengumuman" class="space-y-3"></div>
    </div>

    <!-- VIEW: AKADEMIK -->
    <div id="viewAkademik" class="hidden fade-in space-y-4">
        <h2 class="text-xl font-bold text-fuchsia-800">Akademik Terpadu</h2>
        <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
            <button onclick="filterAkademik('Materi')" class="px-4 py-2 rounded-xl bg-white border border-blue-100 text-xs font-bold text-blue-600 hover:bg-blue-50 transition whitespace-nowrap shadow-sm">üìò Materi</button>
            <button onclick="filterAkademik('Tugas')" class="px-4 py-2 rounded-xl bg-white border border-orange-100 text-xs font-bold text-orange-600 hover:bg-orange-50 transition whitespace-nowrap shadow-sm">üìù Tugas</button>
            <button onclick="filterAkademik('PR')" class="px-4 py-2 rounded-xl bg-white border border-fuchsia-100 text-xs font-bold text-fuchsia-600 hover:bg-fuchsia-50 transition whitespace-nowrap shadow-sm">üè† PR</button>
            <button onclick="filterAkademik('Sumatif')" class="px-4 py-2 rounded-xl bg-white border border-red-100 text-xs font-bold text-red-600 hover:bg-red-50 transition whitespace-nowrap shadow-sm">üìä Sumatif</button>
            <button onclick="filterAkademik('TKA')" class="px-4 py-2 rounded-xl bg-white border border-purple-100 text-xs font-bold text-purple-600 hover:bg-purple-50 transition whitespace-nowrap shadow-sm">üíª TKA</button>
            <button onclick="filterAkademik('Kaldik')" class="px-4 py-2 rounded-xl bg-white border border-teal-100 text-xs font-bold text-teal-600 hover:bg-teal-50 transition whitespace-nowrap shadow-sm">üìÖ Kaldik</button>
        </div>
        <button id="btnTambahAkademik" onclick="showModalUpload()" class="hidden w-full py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-200 mb-2 flex items-center justify-center gap-2 hover:bg-blue-700 transition">
            <i class="fas fa-plus-circle"></i> Tambah Konten Baru
        </button>
        <div id="listAkademik" class="space-y-3 min-h-[200px]"></div>
    </div>

    <!-- VIEW: NILAI GURU -->
    <div id="viewNilaiGuru" class="hidden fade-in space-y-4">
        <div class="card-sd p-5 border-l-4 border-fuchsia-500 shadow-fuchsia-100">
            <h3 class="font-bold text-lg mb-4 text-fuchsia-800">Input Nilai Siswa</h3>
            <div class="space-y-3">
                <div class="flex gap-2">
                    <input id="inKelas" type="number" placeholder="Kelas" class="w-20 p-2 border border-fuchsia-200 rounded-lg text-center font-bold text-fuchsia-700 focus:outline-none focus:border-fuchsia-500">
                    <button onclick="loadSiswaDropdown()" class="flex-1 bg-fuchsia-600 text-white rounded-lg font-bold text-xs hover:bg-fuchsia-700 transition">Cari Siswa</button>
                </div>
                <select id="inSiswa" class="w-full p-2 border border-fuchsia-200 rounded-lg bg-fuchsia-50 font-bold text-fuchsia-800"><option>Pilih Siswa...</option></select>
                <div class="grid grid-cols-2 gap-2">
                    <select id="inKategori" class="w-full p-2 border border-fuchsia-200 rounded-lg text-sm"><option value="Sumatif">Sumatif</option><option value="Tugas">Tugas</option><option value="PR">PR</option><option value="ASAS">ASAS</option><option value="TKA">TKA</option></select>
                    <input id="inMapel" type="text" placeholder="Mapel" class="w-full p-2 border border-fuchsia-200 rounded-lg text-sm">
                </div>
                <input id="inJudul" type="text" placeholder="Judul Penilaian" class="w-full p-2 border border-fuchsia-200 rounded-lg text-sm">
                <input id="inNilai" type="number" placeholder="Nilai (0-100)" class="w-full p-2 border border-fuchsia-200 rounded-lg font-bold text-lg text-fuchsia-600">
                <input id="inCatatan" type="text" placeholder="Saran / Catatan" class="w-full p-2 border border-fuchsia-200 rounded-lg text-sm">
                <button onclick="submitNilai()" id="btnSimpanNilai" class="w-full bg-blue-600 text-white p-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition">SIMPAN NILAI</button>
            </div>
        </div>
    </div>

    <!-- VIEW: NILAI SISWA -->
    <div id="viewNilaiSiswa" class="hidden fade-in space-y-6">
        <div id="leaderboardArea" class="bg-slate-800 text-white rounded-2xl p-5 shadow-xl shadow-slate-300 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-32 h-32 bg-fuchsia-500 rounded-full blur-3xl opacity-20 -ml-10 -mt-10"></div>
            <h3 class="font-bold text-yellow-400 uppercase tracking-widest text-xs mb-4 relative z-10">Papan Juara Kelas</h3>
            <div id="top3Container" class="flex justify-center items-end gap-4 relative z-10"><p class="text-xs opacity-60">Memuat...</p></div>
        </div>
        <div class="space-y-3">
            <h3 class="font-bold text-fuchsia-800">Riwayat Nilai Saya</h3>
            <div id="riwayatNilai" class="space-y-2"></div>
        </div>
    </div>

    <!-- VIEW: MADING (Updated Visual) -->
    <div id="viewMading" class="hidden fade-in space-y-4">
        <h2 class="text-xl font-bold text-fuchsia-800">Mading Kelas</h2>
        <!-- Contoh Konten Mading Statis (Bisa dikembangkan) -->
        <div class="grid grid-cols-1 gap-4">
            <div class="card-sd p-0 overflow-hidden relative">
                <div class="bg-blue-100 h-24 flex items-center justify-center text-blue-300 text-4xl"><i class="fas fa-image"></i></div>
                <div class="p-4">
                    <span class="bg-blue-100 text-blue-600 text-[10px] px-2 py-1 rounded font-bold uppercase">Karya Siswa</span>
                    <h3 class="font-bold text-slate-800 mt-2">Lukisan Pemandangan Kelas 1A</h3>
                    <p class="text-xs text-slate-500 mt-1">Karya: Anisa (1A)</p>
                </div>
            </div>
            <div class="card-sd p-0 overflow-hidden relative">
                <div class="bg-orange-100 h-24 flex items-center justify-center text-orange-300 text-4xl"><i class="fas fa-trophy"></i></div>
                <div class="p-4">
                    <span class="bg-orange-100 text-orange-600 text-[10px] px-2 py-1 rounded font-bold uppercase">Prestasi</span>
                    <h3 class="font-bold text-slate-800 mt-2">Juara 1 Lomba Puisi</h3>
                    <p class="text-xs text-slate-500 mt-1">Selamat kepada Budi Santoso!</p>
                </div>
            </div>
        </div>
        <p class="text-center text-xs text-slate-400 mt-4">- Akhir Mading -</p>
    </div>

    <!-- VIEW: PERPUS -->
    <div id="viewPerpus" class="hidden fade-in">
        <h2 class="text-xl font-bold mb-4 text-blue-800">Perpustakaan Digital</h2>
        <div id="listPerpus" class="grid grid-cols-2 gap-3"></div>
    </div>

    <!-- VIEW: PROFIL -->
    <div id="viewProfil" class="hidden fade-in">
        <div class="text-center mt-6">
            <div class="w-24 h-24 bg-fuchsia-200 rounded-full mx-auto overflow-hidden border-4 border-white shadow-lg shadow-fuchsia-200">
                <img id="profilImg" src="" class="w-full h-full object-cover">
            </div>
            <h2 id="profilNama" class="text-xl font-bold mt-3 text-fuchsia-900">Nama Siswa</h2>
            <p id="profilRole" class="text-sm text-fuchsia-500 font-medium">Siswa Kelas -</p>
            <div id="editProfilGuru" class="hidden mt-6 px-6">
                <p class="text-xs font-bold text-left mb-1 text-slate-500">Update Foto Profil (URL)</p>
                <div class="flex gap-2">
                    <input type="text" id="urlFotoGuru" placeholder="https://..." class="w-full p-2 border border-fuchsia-200 rounded-lg text-sm bg-white">
                    <button onclick="updateFotoGuru()" class="bg-fuchsia-600 text-white px-4 rounded-lg text-xs font-bold">Simpan</button>
                </div>
            </div>
        </div>
    </div>

  </main>

  <!-- 5. MENU BAWAH (3 TOMBOL) -->
  <nav class="bg-white border-t border-fuchsia-100 h-16 fixed bottom-0 w-full flex justify-around items-center z-30 pb-1 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.03)]">
    <button onclick="navTo('home')" id="navBotHome" class="flex flex-col items-center w-16 text-slate-400 transition active:scale-95">
        <i class="fas fa-home text-xl mb-1"></i>
        <span class="text-[10px] font-bold">Home</span>
    </button>
    
    <button onclick="navTo('akademik')" id="navBotAkd" class="flex flex-col items-center w-16 text-slate-400 transition active:scale-95">
        <i class="fas fa-book-open text-xl mb-1"></i>
        <span class="text-[10px] font-bold">Akademik</span>
    </button>

    <!-- Tombol ke-3 Dinamis (Penilaian / Mading) -->
    <button onclick="navToMenuKhusus()" id="navBotKhusus" class="flex flex-col items-center w-16 text-slate-400 transition active:scale-95">
        <i id="iconBotKhusus" class="fas fa-circle text-xl mb-1"></i>
        <span id="labelBotKhusus" class="text-[10px] font-bold">Menu</span>
    </button>
  </nav>

  <!-- MODAL UPLOAD -->
  <div id="modalUpload" class="fixed inset-0 bg-black/40 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white rounded-2xl p-5 w-full max-w-sm max-h-[90vh] overflow-y-auto shadow-2xl">
        <h3 class="font-bold text-lg mb-4 text-fuchsia-800">Upload Konten</h3>
        <div class="space-y-3">
            <select id="upTipe" class="w-full p-2.5 bg-fuchsia-50 border border-fuchsia-100 rounded-xl font-bold text-sm text-fuchsia-800 outline-none"><option value="Materi">Materi</option><option value="Tugas">Tugas</option><option value="PR">PR</option><option value="Sumatif">Sumatif</option><option value="ASAS">ASAS</option><option value="TKA">TKA</option><option value="Kaldik">Kaldik</option></select>
            <select id="upKelas" class="w-full p-2.5 border border-slate-200 rounded-xl text-sm outline-none"><option value="1">Kelas 1</option><option value="2">Kelas 2</option><option value="3">Kelas 3</option><option value="4">Kelas 4</option><option value="5">Kelas 5</option><option value="6">Kelas 6</option></select>
            <select id="upMapel" class="w-full p-2.5 border border-slate-200 rounded-xl text-sm outline-none"><option>Matematika</option><option>B. Indonesia</option><option>IPA</option><option>IPS</option><option>PKN</option><option>PAI</option><option>PJOK</option><option>Seni</option><option>Inggris</option><option>Tematik</option></select>
            <input id="upJudul" type="text" placeholder="Judul Konten" class="w-full p-2.5 border border-slate-200 rounded-xl text-sm outline-none">
            <div class="relative"><i class="fas fa-link absolute left-3 top-3 text-slate-400 text-xs"></i><input id="upLink" type="text" placeholder="Link URL" class="w-full p-2.5 pl-8 border border-slate-200 rounded-xl text-sm text-blue-600 outline-none"></div>
            <input id="upDead" type="text" placeholder="Deadline / Keterangan" class="w-full p-2.5 border border-slate-200 rounded-xl text-sm outline-none">
            <div class="flex gap-2 mt-4"><button onclick="document.getElementById('modalUpload').classList.add('hidden')" class="flex-1 bg-slate-100 text-slate-600 py-2.5 rounded-xl font-bold text-sm">Batal</button><button onclick="submitAkademik()" id="btnSimpanAkd" class="flex-1 bg-fuchsia-600 text-white py-2.5 rounded-xl font-bold text-sm hover:bg-fuchsia-700 shadow-md">Simpan</button></div>
        </div>
    </div>
  </div>

  <!-- LOGIN -->
  <div id="loginOverlay" class="fixed inset-0 z-[60] bg-fuchsia-50 flex flex-col items-center justify-center p-6">
    <div class="text-center w-full max-w-xs bg-white p-8 rounded-3xl shadow-xl border border-fuchsia-100">
        <div class="w-20 h-20 bg-gradient-to-br from-fuchsia-500 to-purple-600 rounded-3xl mx-auto flex items-center justify-center text-white text-4xl mb-5 shadow-lg shadow-fuchsia-200 rotate-6"><i class="fas fa-shapes"></i></div>
        <h1 class="text-2xl font-bold text-fuchsia-900">E-Learning SD</h1>
        <p class="text-xs text-slate-500 mb-6">Portal Belajar Digital Terpadu</p>
        <div class="relative mb-4"><i class="fas fa-envelope absolute left-4 top-3.5 text-fuchsia-300"></i><input type="email" id="emailInput" class="w-full p-3 pl-10 border border-fuchsia-100 rounded-xl bg-fuchsia-50/50 text-sm font-bold text-slate-700 outline-none focus:border-fuchsia-400 focus:bg-white transition" placeholder="Email Sekolah"></div>
        <button onclick="doLogin()" class="w-full p-3 bg-fuchsia-600 text-white rounded-xl font-bold shadow-lg shadow-fuchsia-200 hover:bg-fuchsia-700 transition active:scale-95">MASUK SEKARANG</button>
        <p id="loginMsg" class="text-red-500 text-xs mt-3 font-bold h-4"></p>
    </div>
  </div>

<script>
// CONFIG
const API_URL = "https://script.google.com/macros/s/AKfycbx9R2KHLhCbyIthh1_j6MoZ_Xxohh99NYfvN4iTMEbaDdp-HG4ZI4zMjmVjdKfFn3aqaA/exec";
let USER = null;
const el = (id) => document.getElementById(id);

// AUTH
function doLogin(){
    const email = el('emailInput').value.trim();
    if(!email) return el('loginMsg').innerText = "Email wajib diisi";
    el('loginMsg').innerText = "Memuat...";
    fetch(`${API_URL}?action=login&email=${email}`).then(r=>r.json()).then(d=>{
        if(d.status){
            USER = d;
            el('loginOverlay').classList.add('hidden');
            el('sidebarToggle').classList.remove('hidden');
            initApp();
        } else { el('loginMsg').innerText = d.message; }
    });
}
function doLogout(){ location.reload(); }

// INIT APP
function initApp(){
    el('homeWelcome').innerText = `Halo, ${USER.nama}! (${USER.role})`;
    el('profilNama').innerText = USER.nama;
    el('profilRole').innerText = `${USER.role} ‚Ä¢ Kelas ${USER.kelas}`;
    
    if(USER.foto) el('profilImg').src = USER.foto;
    else if(USER.role==='siswa') el('profilImg').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${USER.nama}`;
    else el('profilImg').src = `https://api.dicebear.com/7.x/bottts/svg?seed=${USER.nama}`;

    if(USER.role === 'guru' || USER.role === 'admin'){
        el('menuGuruSide').classList.remove('hidden');
        el('btnTambahAkademik').classList.remove('hidden');
        el('editProfilGuru').classList.remove('hidden');
        
        // Menu Bawah -> Penilaian
        el('iconBotKhusus').className = "fas fa-star text-xl mb-1";
        el('labelBotKhusus').innerText = "Penilaian";
    } else {
        el('menuSiswaSide').classList.remove('hidden');
        
        // Menu Bawah -> Mading
        el('iconBotKhusus').className = "fas fa-clipboard-list text-xl mb-1";
        el('labelBotKhusus').innerText = "Mading";
    }
    loadHome();
}

// NAVIGATION
function toggleSidebar(){
    const sb = el('sidebar');
    const ov = el('sidebarOverlay');
    if(sb.classList.contains('open')){ sb.classList.remove('open'); ov.classList.add('hidden'); }
    else { sb.classList.add('open'); ov.classList.remove('hidden'); }
}

function navTo(page){
    ['viewHome','viewAkademik','viewNilaiGuru','viewNilaiSiswa','viewMading','viewPerpus','viewProfil'].forEach(id=>el(id).classList.add('hidden'));
    el('sidebar').classList.remove('open'); el('sidebarOverlay').classList.add('hidden');
    
    // Reset Bottom Nav Colors
    ['navBotHome','navBotAkd','navBotKhusus'].forEach(id => el(id).className = "flex flex-col items-center w-16 text-slate-400 transition active:scale-95");

    if(page==='home'){ 
        el('viewHome').classList.remove('hidden'); 
        el('navBotHome').className = "flex flex-col items-center w-16 text-fuchsia-600 transition active:scale-95";
    }
    else if(page==='akademik'){ 
        el('viewAkademik').classList.remove('hidden'); 
        loadAkademik('Materi'); 
        el('navBotAkd').className = "flex flex-col items-center w-16 text-fuchsia-600 transition active:scale-95";
    }
    else if(page==='nilaiGuru'){ el('viewNilaiGuru').classList.remove('hidden'); el('navBotKhusus').className = "flex flex-col items-center w-16 text-fuchsia-600 transition active:scale-95"; }
    else if(page==='nilaiSiswa'){ el('viewNilaiSiswa').classList.remove('hidden'); loadLeaderboard(); }
    else if(page==='mading'){ 
        el('viewMading').classList.remove('hidden'); 
        el('navBotKhusus').className = "flex flex-col items-center w-16 text-fuchsia-600 transition active:scale-95";
    }
    else if(page==='perpus'){ el('viewPerpus').classList.remove('hidden'); loadPerpus(); }
    else if(page==='profil'){ el('viewProfil').classList.remove('hidden'); }
    else if(page==='berita'){ alert("Menu Berita segera hadir!"); navTo('home'); }
}

function navToMenuKhusus(){
    if(USER.role === 'guru' || USER.role === 'admin') navTo('nilaiGuru');
    else navTo('mading');
}

// FEATURES: HOME
function loadHome(){
    fetch(`${API_URL}?action=home`).then(r=>r.json()).then(d=>{
        el('infoNama').innerText = d.info.nama;
        el('infoAlamat').innerText = d.info.alamat;
        el('infoVisi').innerText = d.info.visi;
        el('infoKontak').innerText = d.info.kontak;
        el('infoWeb').innerText = d.info.web;
        el('listPengumuman').innerHTML = d.pengumuman.map(p => `<div class="bg-white p-4 rounded-xl border-l-4 border-blue-400 shadow-sm"><span class="text-[10px] font-bold bg-blue-50 text-blue-600 px-2 py-0.5 rounded">${p.tanggal}</span><h4 class="font-bold text-sm text-slate-800 mt-1">${p.judul}</h4><p class="text-xs text-slate-500 mt-1">${p.isi}</p></div>`).join('') || "<p class='text-center text-xs text-slate-400'>Tidak ada pengumuman.</p>";
    });
}

// FEATURES: AKADEMIK
function filterAkademik(tipe){ loadAkademik(tipe); }
function loadAkademik(tipe){
    el('listAkademik').innerHTML = "<div class='text-center py-10'><i class='fas fa-circle-notch fa-spin text-fuchsia-500'></i></div>";
    fetch(`${API_URL}?action=akademik&kelas=${USER.kelas}`).then(r=>r.json()).then(d=>{
        const filtered = d.data.filter(item => item.tipe === tipe);
        if(filtered.length){
            el('listAkademik').innerHTML = filtered.map(i => `<a href="${i.link}" target="_blank" class="block bg-white p-4 rounded-xl border border-fuchsia-100 shadow-sm hover:border-fuchsia-400 transition relative overflow-hidden group"><div class="absolute top-0 right-0 bg-fuchsia-50 text-fuchsia-600 text-[9px] px-2 py-1 rounded-bl-lg font-bold">${i.deadline || ''}</div><div class="flex items-center gap-3"><div class="w-10 h-10 bg-fuchsia-50 text-fuchsia-600 rounded-full flex items-center justify-center group-hover:bg-fuchsia-600 group-hover:text-white transition"><i class="fas fa-book-open"></i></div><div><span class="text-[9px] font-bold text-slate-400 uppercase tracking-wide bg-slate-50 px-1 rounded">${i.mapel}</span><h4 class="font-bold text-slate-800 text-sm leading-tight mt-0.5">${i.judul}</h4></div></div></a>`).join('');
        } else { el('listAkademik').innerHTML = `<div class="text-center py-10 text-slate-400 text-xs border-2 border-dashed border-fuchsia-100 rounded-xl">Belum ada konten ${tipe}</div>`; }
    });
}
function showModalUpload(){ el('modalUpload').classList.remove('hidden'); }
function submitAkademik(){
    const p = { action: 'simpan_akademik', tipe: el('upTipe').value, kelas: el('upKelas').value, mapel: el('upMapel').value, judul: el('upJudul').value, link: el('upLink').value, deadline: el('upDead').value };
    if(!p.judul || !p.link) return alert("Lengkapi data!");
    el('btnSimpanAkd').innerText = "...";
    fetch(API_URL, {method:'POST', body:JSON.stringify(p)}).then(r=>r.json()).then(d=>{ el('btnSimpanAkd').innerText = "Simpan"; alert(d.message); el('modalUpload').classList.add('hidden'); loadAkademik(p.tipe); });
}

// FEATURES: NILAI
function loadSiswaDropdown(){
    const k = el('inKelas').value;
    if(!k) return alert("Isi kelas!");
    el('inSiswa').innerHTML = "<option>Memuat...</option>";
    fetch(`${API_URL}?action=getSiswa&kelas=${k}`).then(r=>r.json()).then(d=>{ el('inSiswa').innerHTML = d.data.map(s => `<option value="${s.email}">${s.nama}</option>`).join(''); });
}
function submitNilai(){
    const p = { action: 'simpan_nilai', email: el('inSiswa').value, kategori: el('inKategori').value, mapel: el('inMapel').value, judul: el('inJudul').value, nilai: el('inNilai').value, catatan: el('inCatatan').value };
    if(!p.email || !p.nilai) return alert("Data kurang lengkap");
    el('btnSimpanNilai').innerText = "...";
    fetch(API_URL, {method:'POST', body:JSON.stringify(p)}).then(r=>r.json()).then(d=>{ el('btnSimpanNilai').innerText = "SIMPAN NILAI"; alert(d.message); });
}
function loadLeaderboard(){
    fetch(`${API_URL}?action=leaderboard&kelas=${USER.kelas}`).then(r=>r.json()).then(d=>{
        const top3 = d.data;
        if(top3.length){
            el('top3Container').innerHTML = `${top3[1] ? `<div class="text-center w-1/3"><i class="fas fa-medal text-3xl medal-2"></i><p class="text-[10px] font-bold mt-1 truncate text-white">${top3[1].nama}</p><p class="text-xs font-bold text-fuchsia-200">${top3[1].rata}</p></div>` : ''}<div class="text-center w-1/3 mb-6"><i class="fas fa-medal text-5xl medal-1 animate-bounce"></i><p class="text-xs font-bold text-yellow-300 mt-1 truncate">${top3[0].nama}</p><span class="text-xs font-bold bg-white text-slate-900 px-2 rounded-full shadow-lg">${top3[0].rata}</span></div>${top3[2] ? `<div class="text-center w-1/3"><i class="fas fa-medal text-3xl medal-3"></i><p class="text-[10px] font-bold mt-1 truncate text-white">${top3[2].nama}</p><p class="text-xs font-bold text-fuchsia-200">${top3[2].rata}</p></div>` : ''}`;
        } else { el('top3Container').innerHTML = "<p class='text-xs opacity-50 text-white'>Belum ada data</p>"; }
    });
    fetch(`${API_URL}?action=nilai&email=${USER.email}`).then(r=>r.json()).then(d=>{
        el('riwayatNilai').innerHTML = d.data.map(n => `<div class="bg-white p-3 rounded-xl border border-fuchsia-50 flex justify-between items-center shadow-sm"><div><span class="text-[9px] font-bold bg-fuchsia-50 text-fuchsia-600 px-2 py-0.5 rounded uppercase">${n.kategori} ‚Ä¢ ${n.mapel}</span><h4 class="font-bold text-sm mt-1 text-slate-700">${n.judul}</h4></div><div class="text-lg font-bold ${n.nilai>=75?'text-green-600':'text-red-500'}">${n.nilai}</div></div>`).join('');
    });
}
function loadPerpus(){
    el('listPerpus').innerHTML = "Memuat...";
    fetch(`${API_URL}?action=perpus`).then(r=>r.json()).then(d=>{
        el('listPerpus').innerHTML = d.data.map(b => `<a href="${b.link}" target="_blank" class="block bg-white p-4 rounded-xl border border-fuchsia-100 text-center hover:shadow-md transition"><i class="fas fa-book-reader text-3xl text-fuchsia-400 mb-2"></i><h4 class="font-bold text-xs line-clamp-2 text-slate-700">${b.judul}</h4><span class="text-[10px] text-slate-400 bg-slate-50 px-2 rounded mt-1 inline-block">${b.kategori}</span></a>`).join('');
    });
}
function updateFotoGuru(){
    const url = document.getElementById('urlFotoGuru').value; if(!url) return;
    document.getElementById('profilImg').src = url; alert("Foto berhasil diset sementara.");
}
</script>
</body>
</html>